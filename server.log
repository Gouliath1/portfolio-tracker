
> portfolio-tracker@0.1.0 dev
> next dev --turbopack --port 3000

   ▲ Next.js 15.3.3 (Turbopack)
   - Local:        http://localhost:3000
   - Network:      http://192.0.0.2:3000
   - Environments: .env.local

 ✓ Starting...
 ✓ Compiled instrumentation Node.js in 30ms
 ✓ Compiled instrumentation Edge in 14ms
🚀 Initializing database on server startup...
Initializing database schema...
Connected to local SQLite database: ./data/portfolio.db
Creating table: brokers
Creating table: currencies
Creating table: accounts
Creating table: securities
Creating table: position_sets
Creating table: positions
Creating table: securities_prices
Creating table: fx_rates
Database schema created successfully
Inserting default reference data...
Default reference data inserted successfully
Database setup completed successfully
📋 Database has 24 existing positions, skipping demo data
✅ Database initialized successfully
 ✓ Ready in 909ms
 ✓ Compiled /api/historical-data in 442ms
🔄 Historical data refresh initiated...
Connected to local SQLite database: ./data/portfolio.db
📋 Found 24 positions in database
📈 HISTORICAL DATA REFRESH STARTED: 13 symbols
📈 Starting API call count: 0
📈 Symbols to refresh: 3465.T, 4246.T, 7940.T, 8604.T, 8897.T, 8953.T, 8966.T, 8986.T, AAPL, AI.PA, GOOG, NVDA, TSLA
📈 Processing 1/13: 3465.T
📈 fetchHistoricalPrices called for 3465.T
📅 3465.T: First purchase 2025-09-12, 1 months ago, using range: 1y
🌐 [2025-09-13T01:07:57.697Z] YAHOO FINANCE HISTORICAL API CALL #1:
   Symbol: 3465.T
   URL: https://query1.finance.yahoo.com/v8/finance/chart/3465.T?interval=1mo&range=1y
   Range: 1y (1 months of data)
✅ [2025-09-13T01:07:58.469Z] Historical response received for 3465.T (Call #1)
✅ 3465.T: Retrieved 1 historical price points
⏳ Waiting 372ms before next historical request...
📈 Processing 2/13: 4246.T
📈 fetchHistoricalPrices called for 4246.T
📅 4246.T: First purchase 2025-09-10, 1 months ago, using range: 1y
🌐 [2025-09-13T01:07:58.846Z] YAHOO FINANCE HISTORICAL API CALL #2:
   Symbol: 4246.T
   URL: https://query1.finance.yahoo.com/v8/finance/chart/4246.T?interval=1mo&range=1y
   Range: 1y (1 months of data)
✅ [2025-09-13T01:07:59.150Z] Historical response received for 4246.T (Call #2)
✅ 4246.T: Retrieved 1 historical price points
⏳ Waiting 288ms before next historical request...
📈 Processing 3/13: 7940.T
📈 fetchHistoricalPrices called for 7940.T
📅 7940.T: First purchase 2025-09-10, 1 months ago, using range: 1y
🌐 [2025-09-13T01:07:59.442Z] YAHOO FINANCE HISTORICAL API CALL #3:
   Symbol: 7940.T
   URL: https://query1.finance.yahoo.com/v8/finance/chart/7940.T?interval=1mo&range=1y
   Range: 1y (1 months of data)
✅ [2025-09-13T01:07:59.747Z] Historical response received for 7940.T (Call #3)
✅ 7940.T: Retrieved 1 historical price points
⏳ Waiting 309ms before next historical request...
📈 Processing 4/13: 8604.T
📈 fetchHistoricalPrices called for 8604.T
📅 8604.T: First purchase 2025-09-12, 1 months ago, using range: 1y
🌐 [2025-09-13T01:08:00.059Z] YAHOO FINANCE HISTORICAL API CALL #4:
   Symbol: 8604.T
   URL: https://query1.finance.yahoo.com/v8/finance/chart/8604.T?interval=1mo&range=1y
   Range: 1y (1 months of data)
✅ [2025-09-13T01:08:00.396Z] Historical response received for 8604.T (Call #4)
✅ 8604.T: Retrieved 1 historical price points
⏳ Waiting 287ms before next historical request...
📈 Processing 5/13: 8897.T
📈 fetchHistoricalPrices called for 8897.T
📅 8897.T: First purchase 2025-09-12, 1 months ago, using range: 1y
🌐 [2025-09-13T01:08:00.684Z] YAHOO FINANCE HISTORICAL API CALL #5:
   Symbol: 8897.T
   URL: https://query1.finance.yahoo.com/v8/finance/chart/8897.T?interval=1mo&range=1y
   Range: 1y (1 months of data)
✅ [2025-09-13T01:08:00.999Z] Historical response received for 8897.T (Call #5)
✅ 8897.T: Retrieved 1 historical price points
⏳ Waiting 341ms before next historical request...
📈 Processing 6/13: 8953.T
📈 fetchHistoricalPrices called for 8953.T
📅 8953.T: First purchase 2025-09-10, 1 months ago, using range: 1y
🌐 [2025-09-13T01:08:01.343Z] YAHOO FINANCE HISTORICAL API CALL #6:
   Symbol: 8953.T
   URL: https://query1.finance.yahoo.com/v8/finance/chart/8953.T?interval=1mo&range=1y
   Range: 1y (1 months of data)
✅ [2025-09-13T01:08:01.685Z] Historical response received for 8953.T (Call #6)
✅ 8953.T: Retrieved 1 historical price points
⏳ Waiting 359ms before next historical request...
📈 Processing 7/13: 8966.T
📈 fetchHistoricalPrices called for 8966.T
📅 8966.T: First purchase 2025-09-12, 1 months ago, using range: 1y
🌐 [2025-09-13T01:08:02.046Z] YAHOO FINANCE HISTORICAL API CALL #7:
   Symbol: 8966.T
   URL: https://query1.finance.yahoo.com/v8/finance/chart/8966.T?interval=1mo&range=1y
   Range: 1y (1 months of data)
✅ [2025-09-13T01:08:02.347Z] Historical response received for 8966.T (Call #7)
✅ 8966.T: Retrieved 1 historical price points
⏳ Waiting 314ms before next historical request...
📈 Processing 8/13: 8986.T
📈 fetchHistoricalPrices called for 8986.T
📅 8986.T: First purchase 2025-09-10, 1 months ago, using range: 1y
🌐 [2025-09-13T01:08:02.664Z] YAHOO FINANCE HISTORICAL API CALL #8:
   Symbol: 8986.T
   URL: https://query1.finance.yahoo.com/v8/finance/chart/8986.T?interval=1mo&range=1y
   Range: 1y (1 months of data)
✅ [2025-09-13T01:08:02.977Z] Historical response received for 8986.T (Call #8)
✅ 8986.T: Retrieved 1 historical price points
⏳ Waiting 360ms before next historical request...
📈 Processing 9/13: AAPL
📈 fetchHistoricalPrices called for AAPL
📅 AAPL: First purchase 2025-09-10, 1 months ago, using range: 1y
🌐 [2025-09-13T01:08:03.339Z] YAHOO FINANCE HISTORICAL API CALL #9:
   Symbol: AAPL
   URL: https://query1.finance.yahoo.com/v8/finance/chart/AAPL?interval=1mo&range=1y
   Range: 1y (1 months of data)
✅ [2025-09-13T01:08:03.743Z] Historical response received for AAPL (Call #9)
✅ AAPL: Retrieved 1 historical price points
⏳ Waiting 324ms before next historical request...
📈 Processing 10/13: AI.PA
📈 fetchHistoricalPrices called for AI.PA
📅 AI.PA: First purchase 2025-09-12, 1 months ago, using range: 1y
🌐 [2025-09-13T01:08:04.069Z] YAHOO FINANCE HISTORICAL API CALL #10:
   Symbol: AI.PA
   URL: https://query1.finance.yahoo.com/v8/finance/chart/AI.PA?interval=1mo&range=1y
   Range: 1y (1 months of data)
✅ [2025-09-13T01:08:04.406Z] Historical response received for AI.PA (Call #10)
✅ AI.PA: Retrieved 1 historical price points
⏳ Waiting 207ms before next historical request...
📈 Processing 11/13: GOOG
📈 fetchHistoricalPrices called for GOOG
📅 GOOG: First purchase 2025-09-10, 1 months ago, using range: 1y
🌐 [2025-09-13T01:08:04.617Z] YAHOO FINANCE HISTORICAL API CALL #11:
   Symbol: GOOG
   URL: https://query1.finance.yahoo.com/v8/finance/chart/GOOG?interval=1mo&range=1y
   Range: 1y (1 months of data)
✅ [2025-09-13T01:08:04.929Z] Historical response received for GOOG (Call #11)
✅ GOOG: Retrieved 1 historical price points
⏳ Waiting 257ms before next historical request...
📈 Processing 12/13: NVDA
📈 fetchHistoricalPrices called for NVDA
📅 NVDA: First purchase 2025-09-10, 1 months ago, using range: 1y
🌐 [2025-09-13T01:08:05.189Z] YAHOO FINANCE HISTORICAL API CALL #12:
   Symbol: NVDA
   URL: https://query1.finance.yahoo.com/v8/finance/chart/NVDA?interval=1mo&range=1y
   Range: 1y (1 months of data)
✅ [2025-09-13T01:08:05.511Z] Historical response received for NVDA (Call #12)
✅ NVDA: Retrieved 1 historical price points
⏳ Waiting 383ms before next historical request...
📈 Processing 13/13: TSLA
📈 fetchHistoricalPrices called for TSLA
📅 TSLA: First purchase 2025-09-10, 1 months ago, using range: 1y
🌐 [2025-09-13T01:08:05.899Z] YAHOO FINANCE HISTORICAL API CALL #13:
   Symbol: TSLA
   URL: https://query1.finance.yahoo.com/v8/finance/chart/TSLA?interval=1mo&range=1y
   Range: 1y (1 months of data)
✅ [2025-09-13T01:08:06.693Z] Historical response received for TSLA (Call #13)
✅ TSLA: Retrieved 1 historical price points
🏁 HISTORICAL DATA REFRESH COMPLETED:
   Total symbols processed: 13
   Total API calls made: 13
   Total time taken: 9.0s
   Average time per call: 0.7s
💱 Starting FX rates refresh for historical dates...
📅 Found 2 unique transaction dates: 2025-09-10 14:15:57, 2025-09-12 13:44:51
💱 FX RATES REFRESH STARTED for 3 dates (1 price dates + 2 transaction dates)
💱 Starting API call count: 13
💱 Date range: 2025-09-10 14:15:57 to 2025-09-12 13:44:51
📊 Required FX pairs for JPY base: USDJPY, EURJPY
💱 Processing 1/2: USDJPY
💱 fetchHistoricalFxRates called for USDJPY
📅 USDJPY: Date range 2025-09-10 to 2025-09-12, using range: 1y
🌐 [2025-09-13T01:08:06.695Z] YAHOO FINANCE FX HISTORICAL API CALL #14:
   FX Pair: USDJPY (Yahoo: JPY=X)
   URL: https://query1.finance.yahoo.com/v8/finance/chart/JPY=X?interval=1d&range=1y
   Range: 1y (0 months of data)
✅ [2025-09-13T01:08:07.004Z] FX Historical response received for USDJPY (Call #14)
📈 Forward filled USDJPY for 2025-09-10 14:15:57 with rate from 2025-09-10: 147.332
📈 Forward filled USDJPY for 2025-09-12 13:44:51 with rate from 2025-09-12: 147.645
✅ USDJPY: Retrieved 3 historical FX rate points
⏳ Waiting 351ms before next FX pair...
💱 Processing 2/2: EURJPY
💱 fetchHistoricalFxRates called for EURJPY
📅 EURJPY: Date range 2025-09-10 to 2025-09-12, using range: 1y
🌐 [2025-09-13T01:08:07.381Z] YAHOO FINANCE FX HISTORICAL API CALL #15:
   FX Pair: EURJPY (Yahoo: EURJPY=X)
   URL: https://query1.finance.yahoo.com/v8/finance/chart/EURJPY=X?interval=1d&range=1y
   Range: 1y (0 months of data)
✅ [2025-09-13T01:08:07.708Z] FX Historical response received for EURJPY (Call #15)
📈 Forward filled EURJPY for 2025-09-10 14:15:57 with rate from 2025-09-10: 172.438
📈 Forward filled EURJPY for 2025-09-12 13:44:51 with rate from 2025-09-12: 173.261
✅ EURJPY: Retrieved 3 historical FX rate points
🏁 FX RATES REFRESH COMPLETED:
   Total FX pairs processed: 2
   Total API calls made: 2
   Total time taken: 1.0s
   Average time per call: 0.5s
💱 FX rates refresh completed
 POST /api/historical-data 200 in 10577ms
[?25h
